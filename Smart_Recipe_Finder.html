<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Recipe Finder</title>
<style>
:root {
  --bg: #f6f9fc;
  --text: #333;
  --card-bg: #fff;
  --header-bg: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1600');
  --filter-bg: #eee;
  --filter-hover: #ff7043;
  --filter-text-hover: #fff;
}

[data-theme="dark"] {
  --bg: #121212;
  --text: #eee;
  --card-bg: #1e1e1e;
  --filter-bg: #2c2c2c;
  --filter-hover: #ff7043;
  --filter-text-hover: #fff;
}

body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin:0;
  padding:0;
  transition: 0.3s;
}

header {
  background: var(--header-bg) no-repeat center/cover;
  color: white;
  padding: 80px 15px;
  text-align: center;
}

header h1 {
  font-size: 40px;
  text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
}

.theme-toggle {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 8px 12px;
  cursor: pointer;
  border: none;
  border-radius:5px;
  background: var(--filter-hover);
  color: var(--filter-text-hover);
  z-index:1001;
}

.container { display: grid; grid-template-columns: 20% 80%; }

.filters {
  background: var(--card-bg);
  border-right: 1px solid #ddd;
  padding: 10px;
  max-height: calc(100vh - 50px);
  overflow-y: auto;
}

details { margin: 8px 0; }

summary {
  font-weight: bold;
  cursor: pointer;
  padding: 8px;
  background: var(--filter-bg);
  border-radius: 5px;
  color: var(--text);
}

.filter-options {
  display: flex;
  flex-wrap: wrap;
  margin: 8px 0;
}

.filter-options button {
  margin: 5px;
  padding: 7px 12px;
  border: none;
  background: var(--filter-bg);
  color: var(--text);
  border-radius: 5px;
  cursor: pointer;
  transition: 0.3s;
}

.filter-options button.active,
.filter-options button:hover {
  background: var(--filter-hover);
  color: var(--filter-text-hover);
}

.right-section { padding: 15px; }

.search-bar { display: flex; justify-content: center; margin: 15px; }

.search-bar input {
  padding: 10px;
  width: 60%;
  border: 1px solid #ccc;
  border-radius: 5px 0 0 5px;
}

.search-bar button {
  padding: 10px 20px;
  border: none;
  background: var(--filter-hover);
  color: var(--filter-text-hover);
  border-radius: 0 5px 5px 0;
  cursor: pointer;
}

.recipes {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 15px;
  padding: 20px;
}

.recipe-card {
  background: var(--card-bg);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.2s;
}

.recipe-card:hover { transform: scale(1.03); }

.recipe-card img { width: 100%; height: 160px; object-fit: cover; }

.recipe-card h3 { margin: 10px; font-size: 18px; }

.recipe-card p { margin: 10px; font-size: 14px; color: var(--text); }

/* Modal */
.modal {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
  padding:20px;
  z-index:1000;
}

.modal-content {
  background: var(--card-bg);
  border-radius:10px;
  max-width:800px;
  width:90%;
  max-height:90vh;
  overflow-y:auto;
  padding:20px;
  position:relative;
  color: var(--text);
}

.modal-content img { width:100%; border-radius:8px; margin-bottom:15px; }

.modal-content h2 { margin-top:0; color:#ff7043; }

.modal-content h3 { margin:15px 0 5px; }

.modal-content ul { list-style: disc inside; padding:0; }

.ingredients-grid {
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(80px,1fr));
  gap:10px;
  margin:10px 0;
}

.ingredients-grid img { width:100%; border-radius:5px; }
.ingredients-grid p { font-size:12px; text-align:center; margin:0; }
</style>
</head>
<body data-theme="light">
<button class="theme-toggle" onclick="toggleTheme()">Toggle Dark Mode</button>

<header>
  <h1>üç¥ Smart Recipe Finder</h1>
  <p>Find recipes based on ingredients, cuisine, diet & more</p>
</header>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search recipes or ingredients...">
  <button onclick="searchRecipes()">Search</button>
</div>

<div class="container">
  <div class="filters">
    <details open><summary>Category</summary>
      <div class="filter-options" data-filter="category"></div>
    </details>
    <details><summary>Cuisine</summary>
      <div class="filter-options" data-filter="area"></div>
    </details>
    <details><summary>Main Ingredient</summary>
      <div class="filter-options" data-filter="ingredient"></div>
    </details>
  </div>

  <div class="right-section">
    <div class="recipes" id="recipeList"></div>
  </div>
</div>

<div class="modal" id="recipeModal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
const baseUrl = "https://www.themealdb.com/api/json/v1/1/";
let allRecipes = [];
let activeFilters = [];

// Dark mode toggle
function toggleTheme(){
  const theme = document.body.getAttribute("data-theme");
  document.body.setAttribute("data-theme", theme==="light"?"dark":"light");
}

// Load dynamic filters
async function loadFilters(){
  const categories = await fetch(baseUrl+"list.php?c=list").then(r=>r.json());
  const areas = await fetch(baseUrl+"list.php?a=list").then(r=>r.json());
  const ingredients = await fetch(baseUrl+"list.php?i=list").then(r=>r.json());

  const catDiv = document.querySelector('[data-filter="category"]');
  categories.meals.forEach(c => { const btn=document.createElement("button"); btn.innerText=c.strCategory; catDiv.appendChild(btn); });

  const areaDiv = document.querySelector('[data-filter="area"]');
  areas.meals.forEach(a => { const btn=document.createElement("button"); btn.innerText=a.strArea; areaDiv.appendChild(btn); });

  const ingDiv = document.querySelector('[data-filter="ingredient"]');
  ingredients.meals.slice(0,50).forEach(i=>{ const btn=document.createElement("button"); btn.innerText=i.strIngredient; ingDiv.appendChild(btn); });

  document.querySelectorAll(".filter-options button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const parent = btn.parentElement.dataset.filter;
      document.querySelectorAll(`[data-filter="${parent}"] button`).forEach(b=>b.classList.remove("active"));
      const index = activeFilters.findIndex(f=>f[0]===parent);
      if(index!==-1 && activeFilters[index][1]===btn.innerText){ activeFilters.splice(index,1); btn.classList.remove("active"); }
      else { if(index!==-1) activeFilters.splice(index,1); activeFilters.push([parent, btn.innerText]); btn.classList.add("active"); }
      applyFilters();
    });
  });
}

// Fetch all meals by letter
async function fetchAllMeals(){
  const letters = "abcdefghijklmnopqrstuvwxyz";
  let meals = [];
  for(const l of letters){
    const data = await fetch(baseUrl+"search.php?f="+l).then(r=>r.json());
    if(data.meals) meals.push(...data.meals);
  }
  allRecipes = meals;
  applyFilters();
}

// Display recipes
function displayRecipes(recipes){
  const list = document.getElementById("recipeList");
  list.innerHTML = "";
  if(recipes.length===0){ list.innerHTML="<p>No recipes found.</p>"; return; }
  recipes.forEach(recipe=>{
    const card = document.createElement("div"); card.classList.add("recipe-card");
    card.innerHTML=`<img src="${recipe.strMealThumb}" alt="${recipe.strMeal}">
                    <h3>${recipe.strMeal}</h3>
                    <p>Cuisine: ${recipe.strArea||"General"}</p>
                    <p>Category: ${recipe.strCategory}</p>`;
    card.addEventListener("click", ()=>openRecipe(recipe.idMeal));
    list.appendChild(card);
  });
}

// Open recipe modal
async function openRecipe(id){
  const data = await fetch(baseUrl+"lookup.php?i="+id).then(r=>r.json());
  const recipe = data.meals[0];

  let ingredientsHtml="";
  for(let i=1;i<=20;i++){
    const ing = recipe[`strIngredient${i}`];
    const measure = recipe[`strMeasure${i}`];
    if(ing && ing.trim()){
      ingredientsHtml+=`<div><img src="https://www.themealdb.com/images/ingredients/${encodeURIComponent(ing)}.png" title="${ing}"><p>${measure} ${ing}</p></div>`;
    }
  }

  const instructions = recipe.strInstructions ? recipe.strInstructions.split(/\r?\n/).filter(l=>l.trim()!=="") : [];

  const modal = document.getElementById("modalContent");
  modal.innerHTML=`
    <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}">
    <h2>${recipe.strMeal}</h2>
    <p><b>Category:</b> ${recipe.strCategory} | <b>Cuisine:</b> ${recipe.strArea}</p>
    <h3>Ingredients</h3>
    <div class="ingredients-grid">${ingredientsHtml}</div>
    <h3>Instructions</h3>
    <ul>${instructions.map(s=>`<li>${s}</li>`).join("")}</ul>
    ${recipe.strYoutube?`<h3>Video</h3><a href="${recipe.strYoutube}" target="_blank">Watch on YouTube</a>`:""}
  `;
  document.getElementById("recipeModal").style.display="flex";
}

document.getElementById("recipeModal").addEventListener("click", e=>{
  if(e.target.classList.contains("modal")) document.getElementById("recipeModal").style.display="none";
});

// Search recipes by name
function searchRecipes(){
  const query=document.getElementById("searchInput").value.toLowerCase();
  let filtered = allRecipes.filter(r=>r.strMeal.toLowerCase().includes(query));
  displayRecipes(filtered);
}

// Apply filters
function applyFilters(){
  let filtered = [...allRecipes];
  activeFilters.forEach(([type,value])=>{
    filtered = filtered.filter(r=>JSON.stringify(r).toLowerCase().includes(value.toLowerCase()));
  });
  displayRecipes(filtered);
}

// Initialize
loadFilters();
fetchAllMeals();
</script>
</body>
</html>
